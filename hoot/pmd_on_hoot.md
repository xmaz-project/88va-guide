# hootでPMDの楽曲データを演奏

パソコン通信などで配布されたPMDの楽曲データや、PMDを利用した各種市販・同人ソフトの楽曲データをhootに登録し、リストから選択して演奏できるようにする方法のまとめ。PC-9801/PC-88VAの場合について。
PMD利用方法(実機)の知識があることを前提としている。

## PMDとは

KAJA氏によるPC-9801用FM音源ドライバ。PC-88VAやFM TOWNSなどもサポート。

* 公式サイト
    * [http://www5.airnet.ne.jp/kajapon/tool.html]()


## hootとは

サウンド機能に特化したエミュレータ。Windows用。パソコンやゲーム機など様々な機種での楽曲演奏を再現。
画面は、上半分にチャンネル数分のピアノの鍵盤、下半分に楽曲のリストという、パソコン小僧が一度は憧れた、あのユーザーインタフェース。

* 公式サイト
    * [http://dmpsoft.s17.xrea.com/hoot/]()


## hootの仕組み(PMD利用の観点で)

hootは、音源チップとパソコン(ゲーム機)本体のエミュレータの集合体。適切な音源チップ、パソコン本体を選択し、
その上で音源ドライバを動かし、楽曲データを読み込ませることで、演奏を実現する。

演奏に関わるコンポーネントは次のとおり。

1. 音源チップのエミュレータ (hoot内部)
    * OPN(初代VA, 9801-26K搭載のもの), OPNA(VA2/3, 86ボード搭載のもの)をはじめ、様々なものをhootが用意している。
2. パソコン・ゲーム機本体のエミュレータ (hoot内部)
    * 98, 88, VAなど含めこちらも様々なものをhootが用意している。
    * 98/VAであれば、MS-DOS/PC-Engineのシステムコールなどもエミュレートしてくれるらしい。
3. 音源ドライバ
    * 本記事でいえばPMD
4. 楽曲データ
    * PMDの.Mファイルのほか、その.Mが必要とするPCMデータなども。
5. "hoot用ドライバ"
    * hootからの演奏開始・停止などの指示を受けて、音源ドライバをコントロールするプログラム。
    * パソコン・ゲーム機本体のエミュレータ上で動作する。(本記事の場合はMS-DOS/PC-Engine用のプログラムということになる。)

hootで「ドライバー」というと1, 2 を指すことも、5を指すこともある模様。

## hootのインストール

最低限必要な作業は:

* 公式サイトよりダウンロード、展開し、お好みのディレクトリへ配置。主要ファイル・ディレクトリは以下のような構成になる。

    ```text
    <hootインストール先>
    |   hoot.exe
    |   hoot.ini
    |   hoot.xml
    |
    +---etc
    +---outs
    +---skin
    \---xml
    
    ```

* hoot.exe を起動し、鍵盤画面が表示されるか確認する。
* DirectX9がないと小さいエラーダイアログが出る。
    * DirectX11が入っていれば良いというわけではないらしい。
    * 無ければ入手してインストール。
        * https://www.microsoft.com/ja-jp/download/details.aspx?id=35


## hootへの楽曲登録

### 概要

hootへ楽曲を登録するには、次の2つのファイルの作成が必要。

* アーカイブ(ZIPファイル)
    * 音源ドライバ、楽曲データ、hoot用ドライバなど、必要なファイルをZIP圧縮したもの。
* XMLファイル
    * 音源チップ/パソコン本体エミュレータの指定・設定、音源ドライバや楽曲データのファイル一覧
    
### 音源チップ/パソコン本体エミュレータの名称の確認

* drivers.xmlを生成させる。

    ```text
    hoot.exe -list
    ```

* drivers.xml を Internet Explorer で開き、driverとtypeの名前を確認。IEのXSLTの機能を使っているため、IEで開く必要あり。
    ![drivers.xml](../image/hoot/drivers_xml.png)

本記事の目的で言えば、利用するのは
   * driver: pc98dos
       * type: opn, 86 など音源にあわせて選択
   * driver: pc88vados
       * type: opn, opna から音源にあわせて選択

### PMDの入手

* 市販・同人ソフトの場合は、そのディスクから持ってくるのが確実。
* 無ければ、本家サイトから PMD98 Ver 4.8o をダウンロード。  
      * PMD.COM(PC-9801+OPN用)以外は、自己解凍差分PMD48O.COMの実行により得られるが、64bit Windowsではもはや.comの実行はサポートされないため、実機やエミュレータでの実行が必要。

### PMD向けの"hoot用ドライバ"の入手

以下からダウンロード

* 黒羽製作所 > hoot公式xmlメンテナンス > フリーソフト系ドライバ > PMD/PMDB2/PMD86/PMDPPZ(E)/PMDIBM/PX用ドライバ
    * http://kurohane.net/hoot/

展開し、README.TXT を熟読。
    
### アーカイブファイル(ZIP)の作成

以降、PC-9801, PMD.COM を利用する場合を例に説明。

* 以下のファイルを全部入れた、ZIPファイルを作成。
   * PMD.COM (音源ドライバ本体)
   * PMD_98.COM (PMD向けhoot用ドライバ)
   * *.M (PMD楽曲ファイル)
* 楽曲ファイルがPCMを利用している場合は、以下も入れる
   * PMDPCM.EXE (PCMをロードするプログラム。PMDに添付。)
   * *.PPC などPCMファイル
* ZIPファイル内部にサブディレクトリを持たないようにする。

要は、実機でPMD演奏時に使うプログラムとデータファイルはすべてZIPに含める。

### XMLファイルの作成

### hootへの登録

### hootでの演奏確認


    